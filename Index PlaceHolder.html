<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JARVIS ¬∑ Neural Console</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    :root {
        --bg-color: #02040a;
        --glass-bg: rgba(0, 20, 40, 0.4);
        --primary-color: #00f3ff;
        --secondary-color: #0088ff;
        --alert-color: #ff3333;
        --text-color: #e0f7ff;
        --border-color: rgba(0, 243, 255, 0.3);
    }

    * { box-sizing: border-box; }

    body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: 'Rajdhani', sans-serif;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* Background Animation */
    .jarvis-bg {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background:
            radial-gradient(circle at 50% 50%, rgba(0, 40, 80, 0.2) 0%, transparent 60%),
            linear-gradient(0deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
        background-size: 100% 100%, 40px 40px, 40px 40px;
        z-index: -2;
    }

    .scanline {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.5) 51%);
        background-size: 100% 4px;
        pointer-events: none;
        z-index: 100;
        opacity: 0.15;
    }

    /* Header / Top Bar */
    .top-hud {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 30px;
        border-bottom: 1px solid var(--border-color);
        background: rgba(0, 10, 20, 0.8);
        backdrop-filter: blur(5px);
    }

    .logo {
        font-family: 'Share Tech Mono', monospace;
        font-size: 1.5rem;
        color: var(--primary-color);
        text-shadow: 0 0 10px var(--primary-color);
        letter-spacing: 2px;
    }

    .system-status {
        display: flex;
        gap: 20px;
        font-size: 0.9rem;
        color: var(--secondary-color);
    }

    /* Main Layout */
    .main-container {
        display: grid;
        grid-template-columns: 300px 1fr 300px;
        gap: 20px;
        padding: 20px;
        flex: 1;
        overflow: hidden;
    }

    /* Panels */
    .panel {
        background: var(--glass-bg);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        padding: 20px;
        position: relative;
        overflow-y: auto;
    }

    .panel::before { /* Corner accents */
        content: ''; position: absolute; top: 0; left: 0; width: 10px; height: 10px;
        border-top: 2px solid var(--primary-color); border-left: 2px solid var(--primary-color);
    }
    .panel::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 10px; height: 10px;
        border-bottom: 2px solid var(--primary-color); border-right: 2px solid var(--primary-color);
    }

    h2 {
        font-family: 'Share Tech Mono', monospace;
        color: var(--primary-color);
        font-size: 1.1rem;
        margin-top: 0;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Form Elements */
    .form-group { margin-bottom: 15px; }

    label {
        display: block;
        font-size: 0.8rem;
        color: var(--secondary-color);
        margin-bottom: 5px;
        text-transform: uppercase;
    }

    input, textarea, select {
        width: 100%;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid var(--border-color);
        color: #fff;
        padding: 10px;
        font-family: 'Rajdhani', sans-serif;
        font-size: 1rem;
        border-radius: 2px;
        transition: 0.3s;
    }

    input:focus, textarea:focus {
        outline: none;
        box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
        border-color: var(--primary-color);
    }

    /* Central Arc / Visualization */
    .center-stage {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        position: relative;
    }

    .arc-reactor {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        border: 2px solid rgba(0, 243, 255, 0.1);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 50px rgba(0, 243, 255, 0.1);
        margin-bottom: 30px;
    }

    .arc-inner {
        width: 160px; height: 160px;
        border-radius: 50%;
        border: 4px solid var(--primary-color);
        border-top-color: transparent;
        border-bottom-color: transparent;
        animation: spin 4s linear infinite;
        box-shadow: 0 0 20px var(--primary-color);
    }

    .arc-core {
        position: absolute;
        width: 100px; height: 100px;
        background: radial-gradient(circle, #fff 0%, var(--primary-color) 40%, transparent 70%);
        border-radius: 50%;
        opacity: 0.8;
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { transform: scale(0.95); opacity: 0.7; } 50% { transform: scale(1.05); opacity: 1; } }

    /* Action Buttons */
    .action-btn {
        background: rgba(0, 243, 255, 0.1);
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
        padding: 15px 40px;
        font-family: 'Share Tech Mono', monospace;
        font-size: 1.2rem;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 2px;
        transition: 0.3s;
        position: relative;
        overflow: hidden;
        margin-top: 20px;
        width: 100%;
    }

    .action-btn:hover {
        background: var(--primary-color);
        color: #000;
        box-shadow: 0 0 30px var(--primary-color);
    }

    .mic-btn {
        width: 60px; height: 60px;
        border-radius: 50%;
        border: 2px solid var(--primary-color);
        background: transparent;
        color: var(--primary-color);
        font-size: 1.5rem;
        cursor: pointer;
        margin-top: 20px;
        display: flex; align-items: center; justify-content: center;
        transition: 0.3s;
    }

    .mic-btn:hover, .mic-btn.listening {
        background: var(--primary-color);
        color: #000;
        box-shadow: 0 0 20px var(--primary-color);
    }

    /* Logs */
    .log-entry {
        font-family: 'Share Tech Mono', monospace;
        font-size: 0.8rem;
        margin-bottom: 5px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        padding: 2px 0;
    }
    .log-time { color: var(--secondary-color); margin-right: 10px; }
    
    /* Result Links */
    .result-link {
        display: block;
        padding: 15px;
        margin-top: 10px;
        text-decoration: none;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        text-align: center;
        transition: 0.3s;
        background: rgba(0, 243, 255, 0.05);
        font-weight: bold;
    }
    .result-link:hover {
        background: var(--primary-color);
        color: #000;
    }
    
    /* Footer */
    .footer-bar {
        padding: 10px 30px;
        background: rgba(0,0,0,0.8);
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
    }

    @media(max-width: 1000px) {
        .main-container { grid-template-columns: 1fr; overflow-y: auto; }
        .center-stage { order: -1; margin-bottom: 30px; }
    }
  </style>
</head>
<body>
  <div class="jarvis-bg"></div>
  <div class="scanline"></div>

  <!-- HUD Header -->
  <header class="top-hud">
    <div class="logo">J.A.R.V.I.S. <span style="font-size:0.8em; opacity:0.7">NEURAL INTERFACE</span></div>
    <div class="system-status">
        <span>CPU: <span id="cpuUsage">34%</span></span>
        <span>MEM: <span id="memUsage">12TB</span></span>
        <span>NET: ONLINE</span>
        <span id="clock">12:00:00</span>
    </div>
  </header>

  <div class="main-container">
    <!-- Left Panel: Data Entry -->
    <aside class="panel">
        <h2>Mission Data</h2>
        <div class="form-group">
            <label>Project Title</label>
            <input type="text" id="f_titre" placeholder="ENTER TITLE..." value="Transformation Lean">
        </div>
        <div class="form-group">
            <label>Target Entity</label>
            <input type="text" id="f_entrepriseNom" placeholder="ENTER CLIENT..." value="Stark Industries">
        </div>
        <div class="form-group">
            <label>Code</label>
            <input type="text" id="f_codeProjet" placeholder="AUTO-GEN">
        </div>
        
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="form-group">
                <label>Date</label>
                <input type="text" id="f_dateDebut" value="2026-02">
            </div>
            <div class="form-group">
                <label>Duration</label>
                <input type="text" id="f_dureeProjet" value="2 Years">
            </div>
        </div>

        <div class="form-group">
            <label>UPLINK (Attachments)</label>
            <input type="file" id="f_attachments" multiple style="display:none">
            <button onclick="document.getElementById('f_attachments').click()" style="width:100%; padding:10px; background:transparent; border:1px dashed var(--secondary-color); color:var(--secondary-color); cursor:pointer;">[ SELECT FILES ]</button>
            <div id="fileList" style="font-size:0.7rem; color:var(--primary-color); margin-top:5px;">No files uplinking.</div>
        </div>
    </aside>

    <!-- Center Stage: Visuals & Control -->
    <main class="center-stage">
        <div class="arc-reactor">
            <div class="arc-inner"></div>
            <div class="arc-core"></div>
        </div>

        <div style="text-align:center; width: 100%; max-width: 500px;">
            <h2 style="text-align:center; border:none; font-size:1.5rem; text-shadow:0 0 10px var(--primary-color);">SYSTEM READY</h2>
            <div id="statusText" style="color:var(--secondary-color); margin-bottom:20px;">Waiting for input...</div>

            <button id="btnGenerate" class="action-btn">INITIATE PROTOCOL</button>

            <div style="display:flex; justify-content:center; margin-top:10px;">
                <button id="btnVoice" class="mic-btn" title="Voice Command">üé§</button>
            </div>
            <div style="font-size:0.7rem; color:var(--secondary-color); margin-top:5px;">"START" ¬∑ "RESET" ¬∑ "STATUS"</div>
        </div>
    </main>

    <!-- Right Panel: AI & Logs -->
    <aside class="panel">
        <h2>Intelligence Parameters</h2>
        <div class="form-group">
            <label>Context / DNA</label>
            <textarea id="f_ia_histoire" rows="2" placeholder="Analyze target history..."></textarea>
        </div>
        <div class="form-group">
            <label>Problem Vector</label>
            <textarea id="f_ia_probleme" rows="2" placeholder="Identify issues..."></textarea>
        </div>
        <div class="form-group">
            <label>Solution Protocol</label>
            <textarea id="f_ia_solution" rows="2" placeholder="Proposed resolution..."></textarea>
        </div>

        <h2 style="margin-top:20px;">System Logs</h2>
        <div id="consoleLog" style="height: 150px; overflow-y:auto; font-size:0.8rem;">
            <!-- Logs go here -->
        </div>

        <div id="resultLinks" style="display:none; margin-top:20px; animation: fadeIn 1s;">
            <a href="#" id="docLink" target="_blank" class="result-link">üìÑ ACCESS DOCUMENT</a>
            <a href="#" id="pdfLink" target="_blank" class="result-link">‚¨áÔ∏è DOWNLOAD SCHEMATIC (PDF)</a>
            <a href="https://github.com/microsoft/vscode" target="_blank" class="result-link" style="border-color:#fff; color:#fff;">üêô GITHUB REPOSITORY</a>
        </div>
    </aside>
  </div>

  <footer class="footer-bar">
      <div>SECURE CONNECTION ESTABLISHED</div>
      <div>MSI PROPALES B2 // V4.2.0</div>
  </footer>

  <script>
    // --- UTILS ---
    const logList = document.getElementById('consoleLog');
    function log(msg) {
        const div = document.createElement('div');
        div.className = 'log-entry';
        const time = new Date().toLocaleTimeString('fr-FR');
        div.innerHTML = `<span class="log-time">[${time}]</span> ${msg}`;
        logList.prepend(div);
    }

    function updateClock() {
        document.getElementById('clock').textContent = new Date().toLocaleTimeString();
        // Random usage stats
        if(Math.random() > 0.5) document.getElementById('cpuUsage').textContent = Math.floor(Math.random()*40+10) + "%";
        if(Math.random() > 0.5) document.getElementById('memUsage').textContent = Math.floor(Math.random()*5+10) + "TB";
    }
    setInterval(updateClock, 1000);
    log("System initialized.");

    // --- MOCK GOOGLE SCRIPT ---
    // This allows the page to function without the actual App Script backend
    const google = {
        script: {
            run: {
                withSuccessHandler: function(callback) {
                    this.successCallback = callback;
                    return this;
                },
                withFailureHandler: function(callback) {
                    this.failureCallback = callback;
                    return this;
                },
                generateFromForm: function(data) {
                    log("Uploading data to neural core...");
                    setTimeout(() => {
                        log("Processing deep learning vectors...");
                        setTimeout(() => {
                            // Mock Success Response
                            if (this.successCallback) {
                                this.successCallback({
                                    success: true,
                                    url: "https://docs.google.com",
                                    pdfUrl: "https://drive.google.com",
                                    cost: { totalUsd: 0.042 },
                                    error: null
                                });
                            }
                        }, 2000);
                    }, 1500);
                }
            }
        }
    };

    // --- FILE HANDLING ---
    const fileInput = document.getElementById('f_attachments');
    let selectedFiles = [];
    fileInput.addEventListener('change', (e) => {
      selectedFiles = Array.from(e.target.files);
      document.getElementById('fileList').textContent = `${selectedFiles.length} DATABALKS READY TO UPLINK.`;
      log(`Detected ${selectedFiles.length} attachments.`);
    });

    const readFile = (file) => new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => resolve({ name: file.name, mimeType: file.type, bytes: reader.result.split(',')[1] });
      reader.readAsDataURL(file);
    });

    // --- MAIN GENERATION ---
    const btnGenerate = document.getElementById('btnGenerate');

    async function runGeneration() {
      btnGenerate.disabled = true;
      btnGenerate.innerHTML = "PROCESSING...";
      document.getElementById('statusText').textContent = 'CALCULATING TRAJECTORIES...';
      document.querySelector('.arc-core').style.animationDuration = '0.5s'; // Faster spin
      
      const data = {};
      ['titre', 'entrepriseNom', 'codeProjet', 'dateDebut', 'dureeProjet',
       'ia_histoire', 'ia_probleme', 'ia_solution'].forEach(id => {
        data[id] = document.getElementById('f_' + id).value;
      });

      if (selectedFiles.length) {
        log("Encoding binary streams...");
        data.attachments = await Promise.all(selectedFiles.map(readFile));
      }

      google.script.run
        .withSuccessHandler(res => {
          btnGenerate.disabled = false;
          btnGenerate.innerHTML = "INITIATE PROTOCOL";
          document.querySelector('.arc-core').style.animationDuration = '2s'; // Normal spin

          if (res.success) {
            document.getElementById('statusText').textContent = 'MISSION ACCOMPLISHED';
            document.getElementById('statusText').style.color = '#0f0';
            document.getElementById('resultLinks').style.display = 'block';
            log(`PROTOCOL COMPLETE. Cost: $${res.cost.totalUsd}`);
          } else {
            document.getElementById('statusText').textContent = 'SYSTEM FAILURE';
            document.getElementById('statusText').style.color = 'red';
            log(`ERROR: ${res.error}`);
          }
        })
        .withFailureHandler(err => {
            btnGenerate.disabled = false;
            log(`CRITICAL ERROR: ${err}`);
        })
        .generateFromForm(data);
    }

    btnGenerate.addEventListener('click', runGeneration);

    // --- VOICE RECOGNITION (JARVIS) ---
    const btnVoice = document.getElementById('btnVoice');
    if ('webkitSpeechRecognition' in window) {
        const recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.lang = 'en-US'; // Or 'fr-FR' depending on preference

        recognition.onstart = () => {
            btnVoice.classList.add('listening');
            log("Voice module active. Listening...");
        };

        recognition.onend = () => {
            btnVoice.classList.remove('listening');
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.toLowerCase();
            log(`Command recognized: "${transcript}"`);

            if (transcript.includes('start') || transcript.includes('initiate') || transcript.includes('generate') || transcript.includes('lancer')) {
                log("Executing Voice Protocol: START");
                runGeneration();
            } else if (transcript.includes('reset') || transcript.includes('clear')) {
                log("Resetting fields...");
                document.querySelectorAll('input').forEach(i => i.value = '');
            } else if (transcript.includes('status')) {
                alert("SYSTEM STATUS: OPTIMAL. ALL SYSTEMS GO.");
            }
        };

        btnVoice.addEventListener('click', () => {
            recognition.start();
        });
    } else {
        btnVoice.style.display = 'none';
        log("Voice API not supported in this browser.");
    }
  </script>
</body>
</html>
